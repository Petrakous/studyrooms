<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Character encoding and responsive viewport settings -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyRooms SPA</title>
    <!-- Main stylesheet for the SPA UI -->
    <link rel="stylesheet" href="/css/spa.css">
</head>
<body>
<!-- Main application container -->
<div class="app">
    <!-- Page header with title and description -->
    <header>
        <h1>StudyRooms SPA</h1>
        <p class="muted">Single-page client consuming the JWT-secured REST API.</p>
    </header>

    <!-- =====================================================
         SECTION 1: AUTHENTICATION
         Handles user login and JWT token management.
         The token is stored in memory for the session duration.
         ===================================================== -->
    <section class="card" id="auth-card">
        <h2>1. Authenticate</h2>
        <!-- Login form - submits credentials to obtain JWT token -->
        <form id="login-form">
            <!-- Username input field -->
            <div class="field">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" required>
            </div>
            <!-- Password input field (masked) -->
            <div class="field">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required>
            </div>
            <!-- Action buttons and token status indicator -->
            <div class="actions">
                <button type="submit">Sign in &amp; Get Token</button>
                <!-- Status badge showing current token state -->
                <span id="token-status" class="pill pill-muted">No token</span>
                <!-- Logout button - clears the stored JWT token -->
                <button id="logout" type="button" class="secondary">Logout</button>
            </div>
        </form>
        <p class="hint">The token is kept for this session. Use Logout or refresh the page to clear it.</p>
        <!-- Error display area (hidden by default) -->
        <pre id="login-error" class="error hidden"></pre>
    </section>

    <!-- =====================================================
         SECTION 2: STUDY SPACES LIST
         Displays all available study spaces fetched from the API.
         Requires authentication (JWT token) to access.
         ===================================================== -->
    <section class="card" id="spaces-card">
        <div class="card-header">
            <h2>2. Spaces</h2>
            <!-- Manually refresh the spaces list -->
            <button id="reload-spaces" type="button">Reload</button>
        </div>
        <p class="muted">Lists all study spaces using <code>GET /api/spaces</code>.</p>
        <!-- Container for dynamically loaded spaces -->
        <div id="spaces-list" class="list">Sign in first.</div>
        <!-- Error display area (hidden by default) -->
        <pre id="spaces-error" class="error hidden"></pre>
    </section>

    <!-- =====================================================
         STAFF TOOLS (STAFF ONLY)
         Shows quick links for staff users after role check.
         ===================================================== -->
    <section class="card hidden" id="staff-card">
        <h2>Staff tools</h2>
        <p class="muted">Staff-only shortcuts for managing spaces and reservations.</p>
        <div class="staff-actions">
            <a class="button-link" href="/staff/spaces">Manage Spaces</a>
            <a class="button-link" href="/staff/reservations">All Reservations</a>
            <a class="button-link" href="/staff/occupancy">View Occupancy</a>
        </div>
    </section>

    <!-- =====================================================
         SECTION 3: CREATE RESERVATION FORM
         Allows users to book a study space for a specific
         date and time range. Sends POST request with JWT.
         ===================================================== -->
    <section class="card" id="reservation-card">
        <h2>3. Create a reservation</h2>
        <p class="muted">Posts to <code>POST /api/reservations</code> using the Bearer token.</p>
        <form id="reservation-form">
            <!-- Dropdown populated with available study spaces -->
            <div class="field">
                <label for="space-select">Study space</label>
                <select id="space-select" name="studySpaceId" required>
                    <option value="" disabled selected>Select a space</option>
                    <!-- Options are dynamically populated by spa.js -->
                </select>
            </div>
            <!-- Date picker for reservation date -->
            <div class="field">
                <label for="date">Date</label>
                <input type="date" id="date" name="date" required>
            </div>
            <!-- Time range inputs (start and end time) -->
            <div class="field inline">
                <div>
                    <label for="start-time">Start</label>
                    <input type="time" id="start-time" name="startTime" required>
                </div>
                <div>
                    <label for="end-time">End</label>
                    <input type="time" id="end-time" name="endTime" required>
                </div>
            </div>
            <!-- Submit button and status indicator -->
            <div class="actions">
                <button type="submit">Create</button>
                <!-- Status badge showing reservation creation state -->
                <span id="reservation-status" class="pill pill-muted">Waiting</span>
            </div>
        </form>
        <!-- Error display area (hidden by default) -->
        <pre id="reservation-error" class="error hidden"></pre>
    </section>

    <!-- =====================================================
         SECTION 4: MY RESERVATIONS LIST
         Shows all reservations belonging to the logged-in user.
         Allows users to cancel their existing reservations.
         ===================================================== -->
    <section class="card" id="my-reservations-card">
        <div class="card-header">
            <h2>4. My reservations</h2>
            <!-- Manually refresh the user's reservations list -->
            <button id="reload-reservations" type="button">Reload</button>
        </div>
        <p class="muted">Uses <code>GET /api/reservations/my</code> and allows cancelling.</p>
        <!-- Container for dynamically loaded reservations -->
        <div id="reservations-list" class="list">Sign in first.</div>
        <!-- Error display area (hidden by default) -->
        <pre id="reservations-error" class="error hidden"></pre>
    </section>

    <!-- =====================================================
         SECTION 5: STAFF - MANAGE SPACES
         Staff-only tools for creating and removing study spaces.
         ===================================================== -->
    <section class="card hidden" id="staff-spaces-card">
        <div class="card-header">
            <h2>5. Manage spaces (staff)</h2>
            <button id="reload-staff-spaces" type="button">Reload</button>
        </div>
        <p class="muted">Creates and manages study spaces using <code>/api/spaces</code>.</p>
        <form id="staff-space-form">
            <div class="field">
                <label for="staff-space-name">Name</label>
                <input type="text" id="staff-space-name" name="name" required>
            </div>
            <div class="field">
                <label for="staff-space-description">Description</label>
                <input type="text" id="staff-space-description" name="description">
            </div>
            <div class="field inline">
                <div>
                    <label for="staff-space-capacity">Capacity</label>
                    <input type="number" id="staff-space-capacity" name="capacity" min="1" required>
                </div>
                <div>
                    <label for="staff-space-open">Open</label>
                    <input type="time" id="staff-space-open" name="openTime" required>
                </div>
                <div>
                    <label for="staff-space-close">Close</label>
                    <input type="time" id="staff-space-close" name="closeTime" required>
                </div>
            </div>
            <div class="field">
                <label>
                    <input type="checkbox" id="staff-space-fullday" name="fullDay">
                    Full day (open 24 hours)
                </label>
            </div>
            <div class="actions">
                <button type="submit" id="staff-space-submit">Create</button>
                <span id="staff-space-status" class="pill pill-muted">Waiting</span>
            </div>
            <input type="hidden" id="staff-space-id" name="id">
        </form>
        <div id="staff-spaces-list" class="list">Sign in as staff to manage spaces.</div>
        <pre id="staff-spaces-error" class="error hidden"></pre>
    </section>

    <!-- =====================================================
         SECTION 6: STAFF - ALL RESERVATIONS
         Staff-only list with cancellation controls.
         ===================================================== -->
    <section class="card hidden" id="staff-reservations-card">
        <div class="card-header">
            <h2>6. All reservations (staff)</h2>
            <button id="reload-staff-reservations" type="button">Reload</button>
        </div>
        <p class="muted">Uses <code>GET /api/staff/reservations</code> and allows staff cancellation.</p>
        <form id="staff-reservations-form" class="field inline">
            <div>
                <label for="staff-reservations-date">Filter by date</label>
                <input type="date" id="staff-reservations-date" name="date">
            </div>
            <div class="actions">
                <button type="submit">Apply filter</button>
            </div>
        </form>
        <div id="staff-reservations-list" class="list">Sign in as staff to view reservations.</div>
        <pre id="staff-reservations-error" class="error hidden"></pre>
    </section>

    <!-- =====================================================
         SECTION 7: STAFF - OCCUPANCY STATISTICS
         Staff-only occupancy stats for a selected space/date range.
         ===================================================== -->
    <section class="card hidden" id="staff-occupancy-card">
        <div class="card-header">
            <h2>7. Occupancy statistics (staff)</h2>
            <button id="reload-staff-occupancy" type="button">Reload</button>
        </div>
        <p class="muted">Uses <code>GET /api/stats/occupancy</code> to show daily utilisation.</p>
        <form id="staff-occupancy-form" class="field inline">
            <div>
                <label for="staff-occupancy-space">Study space</label>
                <select id="staff-occupancy-space" name="spaceId" required>
                    <option value="" disabled selected>Select a space</option>
                </select>
            </div>
            <div>
                <label for="staff-occupancy-start">Start date</label>
                <input type="date" id="staff-occupancy-start" name="startDate" required>
            </div>
            <div>
                <label for="staff-occupancy-end">End date</label>
                <input type="date" id="staff-occupancy-end" name="endDate" required>
            </div>
            <div class="actions">
                <button type="submit">Load stats</button>
            </div>
        </form>
        <div id="staff-occupancy-summary" class="muted hidden"></div>
        <div id="staff-occupancy-list" class="list">Sign in as staff to view occupancy.</div>
        <pre id="staff-occupancy-error" class="error hidden"></pre>
    </section>
</div>

<!-- Main JavaScript file handling all API interactions and UI updates -->
<script src="/js/spa.js"></script>
</body>
</html>

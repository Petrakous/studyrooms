<!DOCTYPE html>
<!--
    Dashboard Template - StudyRooms Application
    This Thymeleaf template displays the main user dashboard with navigation cards
    for different features. Staff members see additional management options.
-->
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">

<!-- Include the common <head> section from layout.html with the page title -->
<head th:replace="~{layout :: head('Dashboard - StudyRooms')}"></head>

<!--
    Replace body with the layout's body fragment.
    Parameters:
      - 'dashboard': identifies this page for navigation highlighting
      - ~{::content}: passes the content fragment defined below to the layout
-->
<body th:replace="~{layout :: body('dashboard', ~{::content})}">

<!-- Content fragment that will be injected into the layout's main content area -->
<div th:fragment="content">

    <h1 class="mb-4">Welcome to your dashboard!</h1>

    <!-- Responsive grid container for dashboard cards (Bootstrap grid system) -->
    <div class="row g-3">

        <!-- ============================================
             USER CARDS - Visible to all authenticated users
             ============================================ -->

        <!-- Study Spaces Card: Browse available study rooms -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">Study Spaces</h5>
                    <p class="card-text flex-grow-1">
                        Browse the available study rooms in the system.
                    </p>
                    <!-- th:href generates context-aware URLs -->
                    <a th:href="@{/spaces}" class="btn btn-primary mt-auto">
                        View Study Spaces
                    </a>
                </div>
            </div>
        </div>

        <!-- New Reservation Card: Create a new booking -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">New Reservation</h5>
                    <p class="card-text flex-grow-1">
                        Create a new reservation for a study space.
                    </p>
                    <a th:href="@{/reservations/new}" class="btn btn-primary mt-auto">
                        New Reservation
                    </a>
                </div>
            </div>
        </div>

        <!-- My Reservations Card: View and manage user's own reservations -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">My Reservations</h5>
                    <p class="card-text flex-grow-1">
                        View and manage your existing reservations.
                    </p>
                    <a th:href="@{/reservations/my}" class="btn btn-primary mt-auto">
                        My Reservations
                    </a>
                </div>
            </div>
        </div>

        <!-- ============================================
             STAFF CARDS - Visible only to users with STAFF role
             Uses Spring Security's authorization expressions
             ============================================ -->

        <!--
            Manage Spaces Card (Staff Only)
            th:if with #authorization.expression checks if user has STAFF role
            Note: Double single-quotes ('') are used to escape quotes in Thymeleaf
        -->
        <div class="col-md-6 col-lg-4"
             th:if="${#authorization.expression('hasRole(''STAFF'')')}">
            <!-- border-warning gives the card a yellow/orange border to distinguish staff features -->
            <div class="card h-100 border-warning">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">Manage Spaces (Staff)</h5>
                    <p class="card-text flex-grow-1">
                        Staff tools for managing study spaces.
                    </p>
                    <a th:href="@{/staff/spaces}" class="btn btn-outline-warning mt-auto">
                        Manage Spaces
                    </a>
                </div>
            </div>
        </div>

        <!-- All Reservations Card (Staff Only): View system-wide reservations -->
        <div class="col-md-6 col-lg-4"
             th:if="${#authorization.expression('hasRole(''STAFF'')')}">
            <div class="card h-100 border-warning">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">All Reservations (Staff)</h5>
                    <p class="card-text flex-grow-1">
                        View all reservations in the system (staff only).
                    </p>
                    <a th:href="@{/staff/reservations}" class="btn btn-outline-warning mt-auto">
                        All Reservations
                    </a>
                </div>
            </div>
        </div>

        <!--
            Occupancy Statistics Card (Staff Only)
            Uses sec:authorize attribute (Spring Security Thymeleaf dialect)
            as an alternative to th:if with #authorization
        -->
        <div sec:authorize="hasRole('STAFF')" class="col-md-4">
            <div class="p-4 border rounded-3 shadow-sm bg-light border-warning">
                <h5 class="mb-2">Occupancy Statistics (Staff)</h5>
                <p class="text-muted mb-3">View daily and weekly occupancy for study spaces.</p>

                <a th:href="@{/staff/occupancy}" class="btn btn-outline-warning w-100">
                    View Occupancy
                </a>
            </div>
        </div>

        <!-- ============================================
             PENALTY ALERT
             Displayed when user has a reservation penalty
             (e.g., for no-shows or late cancellations)
             ============================================ -->
        <!--
            th:if="${penaltyUntil}" - Only renders if penaltyUntil model attribute exists
            th:text displays the penalty end date passed from the controller
        -->
        <div th:if="${penaltyUntil}" class="alert alert-danger mt-3">
            You are blocked from making new reservations until
            <strong th:text="${penaltyUntil}">2025-01-01</strong>.
        </div>
    </div>

</div>
</body>
</html>
